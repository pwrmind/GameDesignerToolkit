<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Design Simulator</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Cytoscape.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        #cy {
            width: 100%;
            height: 700px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background-color: #fff;
        }
        .tab-pane {
            padding: 15px 0;
        }
        .form-section {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .simulation-controls {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .actor-player { background-color: #4CAF50 !important; }
        .actor-enemy { background-color: #f44336 !important; }
        .actor-world { background-color: #2196F3 !important; }
        .log-container {
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.875rem;
        }
    </style>
</head>
<body x-data="gameSimulator()" x-init="init()">
    <div class="container-fluid py-3">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <h1 class="h3 mb-0">
                        <i class="fas fa-gamepad me-2"></i>Game Design Simulator
                    </h1>
                    <div class="badge bg-primary fs-6">
                        <i class="fas fa-code-branch me-1"></i>v1.0
                    </div>
                </div>
                <p class="text-muted">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –º–µ—Ö–∞–Ω–∏–∫ –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö –∏–≥—Ä</p>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="row">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="controlTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="actors-tab" data-bs-toggle="tab" 
                                        data-bs-target="#actors" type="button" role="tab">
                                    <i class="fas fa-users me-1"></i>–ê–∫—Ç–æ—Ä—ã
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="actions-tab" data-bs-toggle="tab" 
                                        data-bs-target="#actions" type="button" role="tab">
                                    <i class="fas fa-bolt me-1"></i>–î–µ–π—Å—Ç–≤–∏—è
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="modifiers-tab" data-bs-toggle="tab" 
                                        data-bs-target="#modifiers" type="button" role="tab">
                                    <i class="fas fa-magic me-1"></i>–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="simulation-tab" data-bs-toggle="tab" 
                                        data-bs-target="#simulation" type="button" role="tab">
                                    <i class="fas fa-play me-1"></i>–°–∏–º—É–ª—è—Ü–∏—è
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="controlTabsContent">
                            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ (–∏–∑ –≠–¢–ê–ü 3) -->
                            <div class="tab-pane fade show active" id="actors" role="tabpanel">
                                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–æ—Ä–∞ -->
                                <div class="form-section">
                                    <h6 class="mb-3"><i class="fas fa-plus-circle me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–æ—Ä–∞</h6>
                                    <div class="row g-2 mb-3">
                                        <div class="col-6">
                                            <input type="text" class="form-control form-control-sm" 
                                                   x-model="newActor.name" placeholder="–ò–º—è –∞–∫—Ç–æ—Ä–∞">
                                        </div>
                                        <div class="col-6">
                                            <select class="form-select form-select-sm" x-model="newActor.type">
                                                <option value="player">–ò–≥—Ä–æ–∫</option>
                                                <option value="enemy">–í—Ä–∞–≥</option>
                                                <option value="world">–ú–∏—Ä</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-3">
                                        <div class="col-4">
                                            <input type="number" class="form-control form-control-sm" 
                                                   x-model="newActor.health" placeholder="–ó–¥–æ—Ä–æ–≤—å–µ">
                                        </div>
                                        <div class="col-4">
                                            <input type="number" class="form-control form-control-sm" 
                                                   x-model="newActor.energy" placeholder="–≠–Ω–µ—Ä–≥–∏—è">
                                        </div>
                                        <div class="col-4">
                                            <input type="number" class="form-control form-control-sm" 
                                                   x-model="newActor.attack" placeholder="–ê—Ç–∞–∫–∞">
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-sm w-100" @click="addActor()">
                                        <i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–æ—Ä–∞
                                    </button>
                                </div>

                                <!-- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–æ—Ä–æ–≤ -->
                                <div class="form-section">
                                    <h6 class="mb-3"><i class="fas fa-list me-2"></i>–°–ø–∏—Å–æ–∫ –∞–∫—Ç–æ—Ä–æ–≤</h6>
                                    <div class="list-group">
                                        <template x-for="actor in actors" :key="actor.id">
                                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                                <div>
                                                    <span class="badge" 
                                                          :class="{
                                                              'actor-player': actor.type === 'player',
                                                              'actor-enemy': actor.type === 'enemy',
                                                              'actor-world': actor.type === 'world'
                                                          }" x-text="actor.name"></span>
                                                    <small class="text-muted d-block" 
                                                           x-text="`HP: ${actor.currentStats.health} | EN: ${actor.currentStats.energy}`"></small>
                                                </div>
                                                <button class="btn btn-sm btn-outline-danger" @click="removeActor(actor.id)">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ -->
                            <div class="tab-pane fade" id="actions" role="tabpanel">
                                <div class="form-section">
                                    <h6 class="mb-3"><i class="fas fa-plus-circle me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ</h6>
                                    <div class="row g-2 mb-2">
                                        <div class="col-12">
                                            <input type="text" class="form-control form-control-sm" 
                                                   x-model="newAction.name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è">
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-6">
                                            <select class="form-select form-select-sm" x-model="newAction.source">
                                                <option value="">–ò—Å—Ç–æ—á–Ω–∏–∫</option>
                                                <template x-for="actor in actors" :key="actor.id">
                                                    <option :value="actor.id" x-text="actor.name"></option>
                                                </template>
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <select class="form-select form-select-sm" x-model="newAction.target">
                                                <option value="">–¶–µ–ª—å</option>
                                                <template x-for="actor in actors" :key="actor.id">
                                                    <option :value="actor.id" x-text="actor.name"></option>
                                                </template>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-6">
                                            <input type="number" class="form-control form-control-sm" 
                                                   x-model="newAction.cost" placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏">
                                        </div>
                                        <div class="col-6">
                                            <input type="number" class="form-control form-control-sm" 
                                                   x-model="newAction.effect" placeholder="–≠—Ñ—Ñ–µ–∫—Ç (—É—Ä–æ–Ω/–ª–µ—á–µ–Ω–∏–µ)">
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-sm w-100" @click="addAction()">
                                        <i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
                                    </button>
                                </div>

                                <div class="form-section">
                                    <h6 class="mb-3"><i class="fas fa-bolt me-2"></i>–°–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π</h6>
                                    <div class="list-group">
                                        <template x-for="action in actions" :key="action.id">
                                            <div class="list-group-item">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong x-text="action.name"></strong>
                                                        <small class="text-muted d-block" 
                                                               x-text="`${getActorName(action.source)} ‚Üí ${getActorName(action.target)}`"></small>
                                                        <small class="text-muted" 
                                                               x-text="`–°—Ç–æ–∏–º–æ—Å—Ç—å: ${action.cost} | –≠—Ñ—Ñ–µ–∫—Ç: ${action.effect}`"></small>
                                                    </div>
                                                    <button class="btn btn-sm btn-outline-danger" @click="removeAction(action.id)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="modifiers" role="tabpanel">
                                <div class="form-section">
                                    <h6 class="mb-3"><i class="fas fa-plus-circle me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä</h6>
                                    <div class="row g-2 mb-2">
                                        <div class="col-8">
                                            <input type="text" class="form-control form-control-sm" 
                                                   x-model="newModifier.name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞">
                                        </div>
                                        <div class="col-4">
                                            <select class="form-select form-select-sm" x-model="newModifier.type">
                                                <option value="buff">–ë–∞—Ñ—Ñ</option>
                                                <option value="debuff">–î–µ–±–∞—Ñ—Ñ</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-6">
                                            <select class="form-select form-select-sm" x-model="newModifier.target">
                                                <option value="health">–ó–¥–æ—Ä–æ–≤—å–µ</option>
                                                <option value="energy">–≠–Ω–µ—Ä–≥–∏—è</option>
                                                <option value="attack">–ê—Ç–∞–∫–∞</option>
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <input type="number" class="form-control form-control-sm" 
                                                   x-model="newModifier.value" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ">
                                        </div>
                                    </div>
                                    <div class="row g-2 mb-2">
                                        <div class="col-12">
                                            <input type="number" class="form-control form-control-sm" 
                                                   x-model="newModifier.duration" placeholder="–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Ö–æ–¥–æ–≤)">
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-sm w-100" @click="addModifier()">
                                        <i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä
                                    </button>
                                </div>

                                <div class="form-section">
                                    <h6 class="mb-3"><i class="fas fa-magic me-2"></i>–°–ø–∏—Å–æ–∫ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤</h6>
                                    <div class="list-group">
                                        <template x-for="modifier in modifiers" :key="modifier.id">
                                            <div class="list-group-item">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <span class="badge" 
                                                              :class="modifier.type === 'buff' ? 'bg-success' : 'bg-danger'"
                                                              x-text="modifier.name"></span>
                                                        <small class="text-muted d-block" 
                                                               x-text="`${modifier.target}: ${modifier.value > 0 ? '+' : ''}${modifier.value}`"></small>
                                                        <small class="text-muted" x-text="`–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${modifier.duration} —Ö–æ–¥–æ–≤`"></small>
                                                    </div>
                                                    <button class="btn btn-sm btn-outline-danger" @click="removeModifier(modifier.id)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="simulation" role="tabpanel">
                                <div class="simulation-controls">
                                    <h6 class="mb-3"><i class="fas fa-play-circle me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–µ–π</h6>
                                    <div class="row g-2 mb-3">
                                        <div class="col-4">
                                            <button class="btn btn-light btn-sm w-100" :disabled="simulationRunning" @click="startSimulation()">
                                                <i class="fas fa-play me-1"></i>–°—Ç–∞—Ä—Ç
                                            </button>
                                        </div>
                                        <div class="col-4">
                                            <button class="btn btn-warning btn-sm w-100" :disabled="!simulationRunning" @click="pauseSimulation()">
                                                <i class="fas fa-pause me-1"></i>–ü–∞—É–∑–∞
                                            </button>
                                        </div>
                                        <div class="col-4">
                                            <button class="btn btn-danger btn-sm w-100" @click="stopSimulation()">
                                                <i class="fas fa-stop me-1"></i>–°—Ç–æ–ø
                                            </button>
                                        </div>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <button class="btn btn-info btn-sm w-100" @click="stepSimulation()">
                                                <i class="fas fa-step-forward me-1"></i>–®–∞–≥
                                            </button>
                                        </div>
                                        <div class="col-6">
                                            <button class="btn btn-secondary btn-sm w-100" @click="resetSimulation()">
                                                <i class="fas fa-undo me-1"></i>–°–±—Ä–æ—Å
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h6 class="mb-3"><i class="fas fa-tachometer-alt me-2"></i>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–º—É–ª—è—Ü–∏–∏</h6>
                                    <div class="mb-2">
                                        <small class="text-muted">–¢–µ–∫—É—â–∏–π —Ö–æ–¥:</small>
                                        <strong x-text="currentTurn" class="ms-2"></strong>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">–°—Ç–∞—Ç—É—Å:</small>
                                        <span class="badge" :class="simulationRunning ? 'bg-success' : 'bg-secondary'" 
                                              x-text="simulationRunning ? '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è' : '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'" class="ms-2"></span>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h6 class="mb-3"><i class="fas fa-history me-2"></i>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h6>
                                    <div class="log-container">
                                        <template x-for="log in simulationLog.slice().reverse().slice(0, 10)" :key="log.id">
                                            <div class="border-start border-3 ps-2 mb-1" 
                                                 :class="log.type === 'action' ? 'border-primary' : 'border-info'">
                                                <small x-text="log.message" class="text-muted"></small>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-project-diagram me-2"></i>–ò–≥—Ä–æ–≤–∞—è –º–æ–¥–µ–ª—å
                        </h5>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-secondary" @click="resetView()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" @click="exportGraph()">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="cy"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // –ö–æ–¥ –∏–∑ –≠–¢–ê–ü 4, 5, 6
        function initCy() {
            return cytoscape({
                container: document.getElementById('cy'),
                elements: [],
                style: [
                    {
                        selector: 'node',
                        style: {
                            'background-color': '#4CAF50',
                            'label': 'data(name)',
                            'width': 60,
                            'height': 60,
                            'font-size': '14px',
                            'color': '#fff',
                            'text-valign': 'center',
                            'text-halign': 'center'
                        }
                    },
                    {
                        selector: 'node.actor-player',
                        style: {
                            'background-color': '#4CAF50'
                        }
                    },
                    {
                        selector: 'node.actor-enemy',
                        style: {
                            'background-color': '#f44336'
                        }
                    },
                    {
                        selector: 'node.actor-world',
                        style: {
                            'background-color': '#2196F3'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 3,
                            'line-color': '#666',
                            'target-arrow-color': '#666',
                            'target-arrow-shape': 'triangle',
                            'curve-style': 'bezier',
                            'label': 'data(name)',
                            'font-size': '12px',
                            'text-rotation': 'autorotate'
                        }
                    },
                    {
                        selector: 'edge.active',
                        style: {
                            'line-color': '#ff9800',
                            'target-arrow-color': '#ff9800',
                            'width': 5
                        }
                    }
                ],
                layout: {
                    name: 'cose',
                    idealEdgeLength: 100,
                    nodeOverlap: 20,
                    refresh: 20,
                    fit: true,
                    padding: 30,
                    randomize: false,
                    componentSpacing: 100
                }
            });
        }

        function gameSimulator() {
            return {
                actors: [],
                actions: [],
                modifiers: [],
                simulationRunning: false,
                currentTurn: 0,
                simulationLog: [],
                simulationInterval: null,
                newActor: { name: '', type: 'player', health: 100, energy: 50, attack: 10 },
                newAction: { name: '', source: '', target: '', cost: 0, effect: 0 },
                newModifier: { name: '', type: 'buff', target: 'health', value: 0, duration: 0 },
                
                init() {
                    this.cy = initCy();
                    this.updateGraph();
                    this.addDemoData();
                },
                
                addActor() {
                    if (!this.newActor.name) return;
                    const actor = {
                        id: 'actor_' + Date.now(),
                        name: this.newActor.name,
                        type: this.newActor.type,
                        baseStats: {
                            health: parseInt(this.newActor.health) || 100,
                            energy: parseInt(this.newActor.energy) || 50,
                            attack: parseInt(this.newActor.attack) || 10
                        },
                        currentStats: {
                            health: parseInt(this.newActor.health) || 100,
                            energy: parseInt(this.newActor.energy) || 50,
                            attack: parseInt(this.newActor.attack) || 10
                        }
                    };
                    this.actors.push(actor);
                    this.resetNewActor();
                    this.updateGraph();
                    this.addLog('system', `–î–æ–±–∞–≤–ª–µ–Ω –∞–∫—Ç–æ—Ä: ${actor.name}`);
                },
                
                removeActor(actorId) {
                    this.actors = this.actors.filter(a => a.id !== actorId);
                    this.actions = this.actions.filter(a => a.source !== actorId && a.target !== actorId);
                    this.updateGraph();
                    this.addLog('system', `–£–¥–∞–ª–µ–Ω –∞–∫—Ç–æ—Ä: ${this.getActorName(actorId)}`);
                },
                
                resetNewActor() {
                    this.newActor = { name: '', type: 'player', health: 100, energy: 50, attack: 10 };
                },
                
                addAction() {
                    if (!this.newAction.name || !this.newAction.source || !this.newAction.target) return;
                    const action = {
                        id: 'action_' + Date.now(),
                        name: this.newAction.name,
                        source: this.newAction.source,
                        target: this.newAction.target,
                        cost: parseInt(this.newAction.cost) || 0,
                        effect: parseInt(this.newAction.effect) || 0
                    };
                    this.actions.push(action);
                    this.resetNewAction();
                    this.updateGraph();
                    this.addLog('system', `–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ: ${action.name}`);
                },
                
                removeAction(actionId) {
                    const action = this.actions.find(a => a.id === actionId);
                    this.actions = this.actions.filter(a => a.id !== actionId);
                    this.updateGraph();
                    this.addLog('system', `–£–¥–∞–ª–µ–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ: ${action.name}`);
                },
                
                resetNewAction() {
                    this.newAction = { name: '', source: '', target: '', cost: 0, effect: 0 };
                },
                
                addModifier() {
                    if (!this.newModifier.name) return;
                    const modifier = {
                        id: 'modifier_' + Date.now(),
                        name: this.newModifier.name,
                        type: this.newModifier.type,
                        target: this.newModifier.target,
                        value: parseInt(this.newModifier.value) || 0,
                        duration: parseInt(this.newModifier.duration) || 0
                    };
                    this.modifiers.push(modifier);
                    this.resetNewModifier();
                    this.addLog('system', `–î–æ–±–∞–≤–ª–µ–Ω –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä: ${modifier.name}`);
                },
                
                removeModifier(modifierId) {
                    const modifier = this.modifiers.find(m => m.id === modifierId);
                    this.modifiers = this.modifiers.filter(m => m.id !== modifierId);
                    this.addLog('system', `–£–¥–∞–ª–µ–Ω –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä: ${modifier.name}`);
                },
                
                resetNewModifier() {
                    this.newModifier = { name: '', type: 'buff', target: 'health', value: 0, duration: 0 };
                },
                
                getActorName(actorId) {
                    const actor = this.actors.find(a => a.id === actorId);
                    return actor ? actor.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                },
                
                addLog(type, message) {
                    this.simulationLog.push({
                        id: 'log_' + Date.now(),
                        type: type,
                        message: message,
                        timestamp: new Date()
                    });
                },
                
                updateGraph() {
                    const elements = [];
                    this.actors.forEach(actor => {
                        elements.push({
                            data: {
                                id: actor.id,
                                name: actor.name,
                                health: actor.currentStats.health,
                                energy: actor.currentStats.energy
                            },
                            classes: `actor-${actor.type}`
                        });
                    });
                    this.actions.forEach(action => {
                        elements.push({
                            data: {
                                id: action.id,
                                source: action.source,
                                target: action.target,
                                name: action.name,
                                cost: action.cost,
                                effect: action.effect
                            }
                        });
                    });
                    this.cy.elements().remove();
                    this.cy.add(elements);
                    this.cy.layout({ name: 'cose' }).run();
                },
                
                addDemoData() {
                    const demoActors = [
                        { name: '–ò–≥—Ä–æ–∫', type: 'player', health: 100, energy: 50, attack: 15 },
                        { name: '–í—Ä–∞–≥', type: 'enemy', health: 80, energy: 40, attack: 12 },
                        { name: '–ú–∏—Ä', type: 'world', health: 0, energy: 0, attack: 0 }
                    ];
                    demoActors.forEach(actor => {
                        this.newActor = { ...actor };
                        this.addActor();
                    });
                    setTimeout(() => {
                        const demoActions = [
                            { name: '–ê—Ç–∞–∫–∞', source: this.actors[0].id, target: this.actors[1].id, cost: 10, effect: -15 },
                            { name: '–ó–∞—â–∏—Ç–∞', source: this.actors[0].id, target: this.actors[0].id, cost: 5, effect: 10 },
                            { name: '–ö–æ–Ω—Ç—Ä–∞—Ç–∞–∫–∞', source: this.actors[1].id, target: this.actors[0].id, cost: 8, effect: -12 }
                        ];
                        demoActions.forEach(action => {
                            this.newAction = { ...action };
                            this.addAction();
                        });
                    }, 100);
                },
                
                resetView() {
                    this.cy.fit();
                    this.cy.center();
                },
                
                exportGraph() {
                    const png = this.cy.png({ full: true });
                    const link = document.createElement('a');
                    link.download = 'game-model.png';
                    link.href = png;
                    link.click();
                },
                
                simulationStep() {
                    if (!this.simulationRunning) return;
                    this.currentTurn++;
                    this.addLog('system', `--- –•–æ–¥ ${this.currentTurn} ---`);
                    this.cy.edges().removeClass('active');
                    this.actors.forEach(actor => {
                        if (actor.currentStats.health <= 0) return;
                        const availableActions = this.actions.filter(action => 
                            action.source === actor.id && 
                            actor.currentStats.energy >= action.cost
                        );
                        if (availableActions.length > 0) {
                            const randomAction = availableActions[Math.floor(Math.random() * availableActions.length)];
                            this.executeAction(randomAction, actor);
                        }
                    });
                    this.checkWinConditions();
                },
                
                executeAction(action, sourceActor) {
                    const targetActor = this.actors.find(a => a.id === action.target);
                    if (!targetActor) return;
                    const edge = this.cy.getElementById(action.id);
                    edge.addClass('active');
                    sourceActor.currentStats.energy -= action.cost;
                    if (action.effect < 0) {
                        targetActor.currentStats.health += action.effect;
                        if (targetActor.currentStats.health < 0) targetActor.currentStats.health = 0;
                        this.addLog('action', `${sourceActor.name} –∞—Ç–∞–∫—É–µ—Ç ${targetActor.name} –Ω–∞ ${-action.effect} —É—Ä–æ–Ω–∞`);
                    } else if (action.effect > 0) {
                        targetActor.currentStats.health += action.effect;
                        this.addLog('action', `${sourceActor.name} –ø—Ä–∏–º–µ–Ω—è–µ—Ç ${action.name} –Ω–∞ ${targetActor.name}`);
                    }
                    this.updateGraph();
                },
                
                checkWinConditions() {
                    const players = this.actors.filter(a => a.type === 'player' && a.currentStats.health > 0);
                    const enemies = this.actors.filter(a => a.type === 'enemy' && a.currentStats.health > 0);
                    if (players.length === 0) {
                        this.addLog('system', 'üíÄ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í—Å–µ –∏–≥—Ä–æ–∫–∏ –º–µ—Ä—Ç–≤—ã.');
                        this.stopSimulation();
                    } else if (enemies.length === 0) {
                        this.addLog('system', 'üéâ –ü–æ–±–µ–¥–∞! –í—Å–µ –≤—Ä–∞–≥–∏ –ø–æ–±–µ–∂–¥–µ–Ω—ã!');
                        this.stopSimulation();
                    } else if (this.currentTurn >= 50) {
                        this.addLog('system', '‚è∞ –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Ö–æ–¥–æ–≤. –°–∏–º—É–ª—è—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.');
                        this.stopSimulation();
                    }
                },
                
                startSimulation() {
                    if (this.simulationRunning) return;
                    this.simulationRunning = true;
                    this.addLog('system', '–°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞');
                    this.simulationInterval = setInterval(() => {
                        this.simulationStep();
                    }, 2000);
                },
                
                pauseSimulation() {
                    this.simulationRunning = false;
                    if (this.simulationInterval) {
                        clearInterval(this.simulationInterval);
                    }
                    this.addLog('system', '–°–∏–º—É–ª—è—Ü–∏—è –Ω–∞ –ø–∞—É–∑–µ');
                },
                
                stopSimulation() {
                    this.pauseSimulation();
                    this.addLog('system', '–°–∏–º—É–ª—è—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
                },
                
                stepSimulation() {
                    if (!this.simulationRunning) {
                        this.simulationStep();
                    }
                },
                
                resetSimulation() {
                    this.stopSimulation();
                    this.currentTurn = 0;
                    this.actors.forEach(actor => {
                        actor.currentStats.health = actor.baseStats.health;
                        actor.currentStats.energy = actor.baseStats.energy;
                    });
                    this.simulationLog = [];
                    this.updateGraph();
                    this.addLog('system', '–°–∏–º—É–ª—è—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞');
                }
            };
        }
    </script>
</body>
</html>
